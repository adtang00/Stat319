---
title: "Wine and Obesity Data Analysis"
author: "Adrian T. and Olivia K."
date: "December 9, 2025"
format:
  pdf: 
    code-blocks: false
    toc: true
  html:
    toc: true
    toc-location: left
    code-fold: true
    theme: cosmo
---
```{python, echo=False}
#| echo: false
from ucimlrepo import fetch_ucirepo 
import pandas as pd
from scipy import stats
import numpy as np
import matplotlib.pyplot as plt
from statsmodels.graphics.factorplots import interaction_plot
import statsmodels.api as sm
import statsmodels.formula.api as smf

# Fetch the Wine Quality dataset
wine_quality = fetch_ucirepo(id=186)

# Features and targets as pandas DataFrames
X = wine_quality.data.features
y = wine_quality.data.targets

def plot_histogram_q1():
    data = X["density"].values

    sample_size = 50
    num_samples = 5000

    sample_means = []

    for i in range(num_samples):
        sample = np.random.choice(data, size=sample_size, replace=True)
        sample_means.append(np.mean(sample))

    plt.hist(sample_means, bins=30, edgecolor='black')
    plt.xlabel("Sample Mean of Density")
    #plt.title("Sampling Distribution of Sample Mean (Density)")
    plt.show()

def bootstrap():
    #wine_quality = fetch_ucirepo(id=186)
    X = wine_quality.data.features
    df = X['pH'].values

    iter = 10000
    runs = np.zeros(iter)

    for i in range(iter):
        sample = np.random.choice(df, size=len(df), replace=True)
        runs[i] = np.mean(sample)
    return runs

def plot_bootstrap(runs):
    plt.hist(x = runs, bins = 'auto', alpha = 0.7)
    plt.xlabel('Mean of ph')
    plt.ylabel('Frequency')
    plt.title('Bootstrap Distribution of Mean ph')
    plt.show()

def bootstrap_qq(vals):
    stats.probplot(vals, dist="norm", plot=plt)
    plt.title("QQ Plot for Bootstrap Means of pH")
    plt.show()

def mult_comparisons():
    # fetch dataset 
    estimation_of_obesity_levels_based_on_eating_habits_and_physical_condition = fetch_ucirepo(id=544) 
    
    # data (as pandas dataframes) 
    X = estimation_of_obesity_levels_based_on_eating_habits_and_physical_condition.data.features 
    y = estimation_of_obesity_levels_based_on_eating_habits_and_physical_condition.data.targets 
    
    # metadata 
    #print(estimation_of_obesity_levels_based_on_eating_habits_and_physical_condition.metadata) 
    
    # variable information 
    #print(estimation_of_obesity_levels_based_on_eating_habits_and_physical_condition.variables) 

    df = pd.concat([X, y], axis=1)
    df.columns = list(X.columns) + list(y.columns)

    df['MTRANS_str'] = df['MTRANS'].astype(str)
    df['CAEC_str'] = df['CAEC'].astype(str)


    # Interaction plot
    fig, ax = plt.subplots(figsize=(12, 8))
    interaction_plot(
    df['MTRANS'], df['CAEC'], df['Weight'],
    colors=['red','blue','green','orange'],
    markers=['o','s','^','D'], ms=8,
    ax=ax # pass axes to avoid auto (a)/(b)
    )
    ax.set_xlabel('MTRANS')
    ax.set_ylabel('Weight (kg)')
    #ax.set_title('Interaction Plot: Weight by MTRANS and CAEC')

    plt.show()

    model = smf.ols("Weight ~ C(MTRANS) + C(CAEC)", data=df).fit()
    
    return model

def plot_resid_fitted(model):
    residuals = model.resid
    fitted = model.fittedvalues
    # Create plots
    fig, ax = plt.subplots(1, 2, figsize=(12,5))

    # 1. Q-Q plot of residuals
    sm.qqplot(residuals, line='s', ax=ax[0])
    ax[0].set_title('QQ Plot of Residuals')

    # 2. Residuals vs Fitted plot
    ax[1].scatter(fitted, residuals)
    ax[1].axhline(0, color='red', linestyle='--')
    ax[1].set_xlabel('Fitted values')
    ax[1].set_ylabel('Residuals')
    ax[1].set_title('Residuals vs Fitted')

    plt.tight_layout()
    plt.show()

def hypothesis_test(model):
    anova_table = sm.stats.anova_lm(model, typ=2)
    # 4. Hypothesis test for equality of means
    # Calculate MSA and MSB
    msa = anova_table['sum_sq']['C(MTRANS)'] / anova_table['df']['C(MTRANS)']
    msb = anova_table['sum_sq']['C(CAEC)'] / anova_table['df']['C(CAEC)']
    mse = anova_table['sum_sq']['Residual'] / anova_table['df']['Residual']

    # Calculate F-statistics
    f_stat_a = msa / mse
    f_stat_b = msb / mse
    print(f"F-statistic for MTRANS: {f_stat_a}")
    print(f"F-statistic for CAEC: {f_stat_b}")

    # Critical F-value
    alpha = 0.05
    f_crit_a = stats.f.ppf(1 - alpha, anova_table['df']['C(MTRANS)'], anova_table['df']['Residual'])
    f_crit_b = stats.f.ppf(1 - alpha, anova_table['df']['C(CAEC)'], anova_table['df']['Residual'])
    print(f"Critical F-value for MTRANS: {f_crit_a}")
    print(f"Critical F-value for CAEC: {f_crit_b}")

    # p-values
    p_value_a = 1 - stats.f.cdf(f_stat_a, anova_table['df']['C(MTRANS)'], anova_table['df']['Residual'])
    p_value_b = 1 - stats.f.cdf(f_stat_b, anova_table['df']['C(CAEC)'], anova_table['df']['Residual'])
    print(f"P-value for MTRANS: {p_value_a}")   
    print(f"P-value for CAEC: {p_value_b}")


    # Conclusion
    if f_stat_a > f_crit_a:
        print("Reject null hypothesis for MTRANS: At least one group mean is different.")
    else:
        print("Fail to reject null hypothesis for MTRANS: No significant difference between group means.") 
    if f_stat_b > f_crit_b:
        print("Reject null hypothesis for CAEC: At least one group mean is different.")
    else:
        print("Fail to reject null hypothesis for CAEC: No significant difference between group means.")

    return anova_table

def multiple_comparisons(model):
    from statsmodels.stats.multicomp import pairwise_tukeyhsd
    import pandas as pd

    # Extract dataframe used in the model
    df = model.model.data.frame.copy()

    # Convert factors to string for Tukey labels
    df['MTRANS_str'] = df['MTRANS'].astype(str)
    df['CAEC_str'] = df['CAEC'].astype(str)

    # --- Tukey for MTRANS ---
    tukey_mtrans = pairwise_tukeyhsd(
        endog=df['Weight'],
        groups=df['MTRANS_str'],
        alpha=0.05
    )

    # Convert Tukey result to DataFrame
    mtrans_df = pd.DataFrame(
        data=tukey_mtrans._results_table.data[1:],   # skip header row
        columns=tukey_mtrans._results_table.data[0]  # use header row
    )

    # --- Tukey for CAEC ---
    tukey_caec = pairwise_tukeyhsd(
        endog=df['Weight'],
        groups=df['CAEC_str'],
        alpha=0.05
    )

    caec_df = pd.DataFrame(
        data=tukey_caec._results_table.data[1:],
        columns=tukey_caec._results_table.data[0]
    )
    return mtrans_df, caec_df

```

# 1. Dataset Overview

## 1.1 Wine Quality Dataset

- **Collection Year:** 2009
- **Study Type:** Observational; each wine sample measured independently.
- **Description:** Physiochemical properties for red and white Portuguese "Vinho Verde" wines.  
- **Size:** 6497 rows, 12 columns  
- **Variables:** `fixed_acidity`, `volatile_acidity`, `citric_acid`, `residual_sugar`, `chlorides`, `free_sulfur_dioxide`, `total_sulfur_dioxide`, `density`, `ph`, `sulphates`, `alcohol`, `quality`, `color`  

| Variable Name           | Role    | Type        | Description                   |
|-------------------------|---------|-------------|-------------------------------|
| fixed_acidity          | Feature | Continuous  |                               |
| volatile_acidity       | Feature | Continuous  |                               |
| citric_acid            | Feature | Continuous  |                               |
| residual_sugar         | Feature | Continuous  |                               |
| chlorides              | Feature | Continuous  |                               |
| free_sulfur_dioxide    | Feature | Continuous  |                               |
| total_sulfur_dioxide   | Feature | Continuous  |                               |
| density                | Feature | Continuous  |                               |
| pH                     | Feature | Continuous  |                               |
| sulphates              | Feature | Continuous  |                               |
| alcohol                | Feature | Continuous  |                               |
| quality                | Target  | Integer     | score between 0 and 10        |
| color                  | Other   | Categorical | red or white                  |
: Dataset 1 Variables {tbl-q1-tb1}



### Sampling Distribution of Density

The following histogram shows the sampling distribution of the **sample mean of the `density` variable**.

```{python}
#| echo: false
#| label: fig-q1
#| fig-cap: "Sampling Distribution of Sample Mean (Density)"
plot_histogram_q1()
```

@fig-q1 shows the sampling distribution of the sample mean of wine densities. The shape of the sampling distribution is approximately normal with little to no skew.


## 1.2 Obesity Dataset

- **Collection Year:** 2019
- **Study Type:** Observational; each individual measured independently.
- **Description:** Estimation of obesity levels in individuals from Mexico, Peru, and Colombia, based on eating habits and physical condition.  
- **Size:** 2111 rows, 16 columns  
- **Variables:** `Gender`, `Age`, `Height`, `Weight`, `Family_history_with_overweight`, `FAVC`, `FCVC`, `NCP`, `CAEC`, `SMOKE`, `CH20`, `SCC`, `FAF`, `TUE`, `CALC`, `MTRANS`, `NObeyesdad`

| Variable Name                     | Role    | Type        | Description                           | Units     |
|----------------------------------|---------|------------|---------------------------------------|----------|
| Gender                            | Feature | Categorical| Biological sex                        | -        |
| Age                               | Feature | Continuous | Age in years                           | Years    |
| Height                            | Feature | Continuous | Height                                  | Meters   |
| Weight                            | Feature | Continuous | Weight                                  | Kg       |
| Family_history_with_overweight    | Feature | Binary     | Family history of overweight           | -        |
| FAVC                              | Feature | Binary     | Frequent high-calorie food intake      | -        |
| FCVC                              | Feature | Integer    | Frequency of vegetable consumption     | -        |
| NCP                               | Feature | Continuous | Number of main meals per day           | Count    |
| CAEC                              | Feature | Categorical| Snacking between meals                 | -        |
| SMOKE                             | Feature | Binary     | Smokes or not                           | -        |
| CH20                              | Feature | Binary     | Monitors calorie intake                | -        |
| SCC                               | Feature | Continuous | Physical activity frequency            | Hours/Week |
| FAF                               | Feature | Continuous | Daily screen/technology use            | Hours    |
| TUE                               | Feature | Continuous | Daily electronics use                  | Hours    |
| CALC                              | Feature | Categorical| Alcohol consumption                     | -        |
| MTRANS                            | Feature | Categorical| Mode of transportation                 | -        |
| NObeyesdad                        | Target  | Categorical| Obesity classification                 | -        |
: Dataset 2 Variables {tbl-q1-tb2}

---

# 2. One-Sample T-Test: Wine Alcohol Content
## 2.1 Research Question and Hypothesis
**Research Question:** Is the average alcohol content of red and white wine greater than 10.5%?

**Hypotheses:**  
The null hypothesis states that the population mean alcohol content is equal to 10.5%, while the alternate hypothesis claims the population mean alcohol content is greater than 10.5%.  

## 2.2 Assumptions

## 2.3 Test 
**Results:**  
- Sample mean: 10.4918  
- t-statistic: -0.5541  
- Critical t-value (α = 0.05): 1.6451  
- One-tailed p-value: 0.7102  
- 95% Confidence Interval: (10.4628, 10.5208)  

## 2.4 Conclusion:** 
Since the critical t-value was greater than alpha, we fail to reject the null hypothesis. There is insufficient evidence that the mean alcohol content exceeds 10.5%.  

---

# 3. Bootstrap Approach: Wine pH

## 3.1 Bootstrap Distribution
```{python}
#| echo: false
#| label: fig-q3-1
#| fig-cap: "Bootstrap Distribution of Wine pH"
#| fig-pos: "H"
vals = bootstrap()
plot_bootstrap(vals)
```

## 3.2 QQ Plot for Bootstrap
```{python}
#| echo: false
#| label: fig-q3-2
#| fig-cap: "QQ Plot of Bootstrap Means (pH)"
#| fig-pos: "H"
bootstrap_qq(vals)
```

## 3.3 Bootstrap Confidence Interval
```{python, echo=False}
#| echo: false
# Run the bootstrap and compute CI
#vals = bootstrap()
lower = np.percentile(vals, 2.5)
upper = np.percentile(vals, 97.5)
(lower, upper)
```

**Conclusion:** Using an alpha of 0.05, We are 95% confident that the true population mean pH lies between 3.215 and 3.222.  

---


# 4. Analysis of Variance (Wine Dataset)

## 4.1 F Test

## 4.2 ANOVA Table

## 4.3 AVOVA Assumptions Check

## 4.4 Conclusion

---

# 5. Multiple Comparisons (Obesity Dataset)
## 5.1 ANOVA Model and Assumptions
```{python}
#| echo: false
#| label: fig-q5-1
#| fig-cap: "Two-way ANOVA with interaction: Weight ~ MTRANS * CAEC"
#| fig-pos: "H"
model = mult_comparisons()
```

- **Interpretation:** Based on @fig-q5-1, Weight differs across the different MTRANS (Method of Transportation) categories. The lines for different CAEC overlap, suggesting a relationship exists between MTRANS and CAEC levels.

## 5.2 QQ Plot and Residual Analysis:
```{python}
#| echo: false
#| label: fig-q5-2
#| fig-cap: "QQ Plot and Residual Plot"
#| fig-pos: "H"
plot_resid_fitted(model)
```

  - QQ plot shows approximate normality as the data falls around the line.  
  - Residual plot shows no clear pattern.  
- **Conclusion:** ANOVA assumptions satisfied (normality, independence, equal variance).  

## 5.3 F-Tests for Factors

| Factor  | F-statistic | F-critical | p-value         | Conclusion |
|---------|------------|------------|----------------|------------|
| MTRANS  | 6.85       | 2.376      | $1.78 \times 10^{-5}$   | Reject H₀: At least one group mean differs |
| CAEC    | 149.69     | 2.609      | $1.11 \times 10^{-16}$   | Reject H₀: At least one group mean differs |
: ANOVA results for MTRANS and CAEC factors {#tbl-anova_mtrans_caec}

**Interpretation:** Both MTRANS and CAEC significantly affect Weight; differences between group means are unlikely due to chance.  

## 5.4 Pairwise Comparisons
```{python}
#| echo: false
mtrans_df, caec_df = multiple_comparisons(model)
```


```{python}
#| echo: false
#| label: tbl-q5-1
#| tbl-cap: "Tukey HSD Pairwise Comparison for MTRANS"
mtrans_df
```

**Conclusion:** From @fig-q5-1, the Tukey HSD pairwise comparisons revealed a few significant differences between pairs of transportation methods. There were differences between Automobile vs. Walking and also Public Transportation vs. Walking. The mean difference in Weight were 15.3 and 16.9 respectivly. These results suggest that walking is assosiated with a lower average weight. 

```{python}
#| echo: false
#| label: tbl-q5-2
#| tbl-cap: "Tukey HSD Pairwise Comparison for CAEC"
caec_df
```

**Conclusion:** 

---



# 6. References
Cortez, Paulo, et al. "Wine Quality." UCI Machine Learning Repository, 2009, https://doi.org/10.24432/C56S3T.

"Estimation of Obesity Levels Based On Eating Habits and Physical Condition ." UCI Machine Learning Repository, 2019, https://doi.org/10.24432/C5H31Z.

---`

# 7. Code Appendix